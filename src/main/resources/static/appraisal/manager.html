<!DOCTYPE html>
<html lang="en" class="pixel-ratio-3 retina ios ios-10 ios-10-3 ios-gt-9 ios-gt-8 ios-gt-7 ios-gt-6">
<head>
    <meta charset="UTF-8">
	<meta http-equiv="X-UA-Compatible" content="IE=edge">
	<meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no">

	<meta name="description" content="Write an awesome description for your new site here. You can edit this line in _config.yml. It will appear in your document head meta (for Google search results) and in your feed.xml site description.
	">
    <title>后台管理</title>
    <!-- head 中 -->
    <link rel="stylesheet" href="https://cdn.bootcss.com/weui/1.1.2/style/weui.min.css">
    <link rel="stylesheet" href="https://cdn.bootcss.com/jquery-weui/1.2.0/css/jquery-weui.min.css">

	<link rel="stylesheet" href="common.css">
</head>



 <body ontouchstart="" style="background-color: rgb(246, 244, 236);">
	 <div class="weui-tab">

		 <!--<h1 class="demos-title">下拉刷新</h1>-->
		 <header class="demos-header">
			<h1 class="demos-title" id="home" style="font-size: 2em;">后台管理</h1>
			<!--<h5 class="demos-title" id="home">测评后台</h5>-->
		</header>
		 <div class="maxDiv" >

			 <!-- body 顶部加上如下代码 -->
			 <div class="weui-pull-to-refresh__layer">
				 <div class='weui-pull-to-refresh__arrow'></div>
				 <div class='weui-pull-to-refresh__preloader'></div>
				 <div class="down">下拉刷新</div>
				 <div class="up">释放刷新</div>
				 <div class="refresh">正在刷新</div>
			 </div>


			<div id="oneDiv">



				 <div class="weui-cells__title" id="showText2">历史填报信息：</div>
				<div class="weui-cells" style="background-color: rgb(246, 244, 236);">

				  <a class="weui-cell weui-cell_access oneList"  name="geilixinli_90" href="javascript:;">
					<div class="weui-cell__hd"><img src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAC4AAAAuCAMAAABgZ9sFAAAAVFBMVEXx8fHMzMzr6+vn5+fv7+/t7e3d3d2+vr7W1tbHx8eysrKdnZ3p6enk5OTR0dG7u7u3t7ejo6PY2Njh4eHf39/T09PExMSvr6+goKCqqqqnp6e4uLgcLY/OAAAAnklEQVRIx+3RSRLDIAxE0QYhAbGZPNu5/z0zrXHiqiz5W72FqhqtVuuXAl3iOV7iPV/iSsAqZa9BS7YOmMXnNNX4TWGxRMn3R6SxRNgy0bzXOW8EBO8SAClsPdB3psqlvG+Lw7ONXg/pTld52BjgSSkA3PV2OOemjIDcZQWgVvONw60q7sIpR38EnHPSMDQ4MjDjLPozhAkGrVbr/z0ANjAF4AcbXmYAAAAASUVORK5CYII=" alt="" style="width:20px;margin-right:5px;display:block"></div>
					<div class="weui-cell__bd">
					  <p>十项症状自评量表SCL90</p>
					</div>
					<div class="weui-cell__ft">90题</div>
				  </a>
				  <a class="weui-cell weui-cell_access oneList" name="pressure_PSTR" href="javascript:;">
					<div class="weui-cell__hd"><img src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAC4AAAAuCAMAAABgZ9sFAAAAVFBMVEXx8fHMzMzr6+vn5+fv7+/t7e3d3d2+vr7W1tbHx8eysrKdnZ3p6enk5OTR0dG7u7u3t7ejo6PY2Njh4eHf39/T09PExMSvr6+goKCqqqqnp6e4uLgcLY/OAAAAnklEQVRIx+3RSRLDIAxE0QYhAbGZPNu5/z0zrXHiqiz5W72FqhqtVuuXAl3iOV7iPV/iSsAqZa9BS7YOmMXnNNX4TWGxRMn3R6SxRNgy0bzXOW8EBO8SAClsPdB3psqlvG+Lw7ONXg/pTld52BjgSSkA3PV2OOemjIDcZQWgVvONw60q7sIpR38EnHPSMDQ4MjDjLPozhAkGrVbr/z0ANjAF4AcbXmYAAAAASUVORK5CYII=" alt="" style="width:20px;margin-right:5px;display:block"></div>
					<div class="weui-cell__bd">
					  <p>PSTR心理压力测试</p>
					</div>
					<div class="weui-cell__ft">50题</div>
				  </a>
				</div>
			</div>
			 <div id="towDiv"  style="display:none;">
				 <div class="weui-cells__title">姓名-性别-年龄-手机号（下拉刷新）：</div>
				<div id="towList" class="weui-cells" style="background-color: rgb(246, 244, 236);">
					<!-- 二级列表 -->
				</div>
			</div>
		 </div>

	 </div>

	 <!-- Footer底部页脚START -->
	 <div class="weui-footer weui-footer_fixed-bottom">
		 <p class="weui-footer__links">
			 <a href="list.html" id="listHtml" class="weui-footer__link">首页</a>
			 <a href="javascript:showHome();" class="weui-footer__link">后台管理</a>
		 </p>
		 <p class="weui-footer__text">Copyright © 2018-2021 alibbb.com.cn</p>
	 </div>
	 <!-- Footer底部页脚END -->
 </body>

<!-- body 最后 -->
<script src="https://cdn.bootcss.com/jquery/1.11.0/jquery.min.js"></script>
<script src="../common/utils/commonUtils.js"></script>

<script>

    //获取渠道参数
    var ditch = GetQueryString('ditch');
    //lfsxlwsxh = 临汾市心理卫生协会
    //xlk = 心理科
    //根据渠道判断展示的名称
    if(ditch){
        var showText = "";
        switch(ditch){
            case 'xlk':
                showText = '心理科';
                showHtml = '心理科';
                $('#logo').remove();	//删除logo
                break;
            case 'lfsxlwsxh':
                showText = '临汾市心理卫生协会';
                showHtml = '<p>临汾市心理卫生协会</p>';
                break;
            default:
                $('#logo').remove();
                break;
        }

        $('title').text(showText + '管理平台');
        $('#home').html(showHtml + '管理平台');
        // $('#geilixinli_90').attr('href', $('#geilixinli_90').attr('href') + '?ditch=' + ditch);
        // $('#pressure_PSTR').attr('href', $('#pressure_PSTR').attr('href') + '?ditch=' + ditch);
        $('#listHtml').attr('href', $('#listHtml').attr('href') + '?ditch=' + ditch);
        $('#showText2').text(showText + '（历史填报信息：）：');
    }


</script>

<script src="https://cdn.bootcss.com/jquery-weui/1.2.0/js/jquery-weui.min.js"></script>
<script src="../common/utils/commonUtils.js" type="text/javascript"></script>
<!-- 如果使用了某些拓展插件还需要额外的JS -->
<script src="https://cdn.bootcss.com/jquery-weui/1.2.0/js/swiper.min.js"></script>
<script src="https://cdn.bootcss.com/jquery-weui/1.2.0/js/city-picker.min.js"></script>

<script>
	var type;
	//登陆状态默认未登录
	var loginStarus = 'false';
		//getCookie(loginStarus);
	function getList(type) {
	    //清空二级列表数据
        $('#towList').html('');
		$.ajax({
		//几个参数需要注意一下
			type: "POST",//方法类型
			dataType: "jsonp",//预期服务器返回的数据类型
			url: "http://140.143.237.60:8010/appraisal/getSubjectRecordList.json" ,//url
			data: {
				limit:1000,
				offset:0,
				type:type,
				ditch:ditch
			},
			success: function (result) {
				console.log(result);//打印服务端返回的数据(调试用)
				//$('.q_info').remove();
				//$('#testform').append('<div class="q_info" style="display: block;" >' + result.html.replace(/@xiaoyu/g,'<').replace(/@dayu/g,'>') + '</div>');

                var defStr = '空';
                if(!result || result.length == 0){	//暂无填报记录
                    $('#towList').append(`	  <a class="weui-cell weui-cell_access" href="javascript:;">
											<div class="weui-cell__hd"></div>
											<div class="weui-cell__bd">
											  <p>暂无填报记录</p>
											</div>
											<div class="weui-cell__ft">`+new Date().Format("MM-dd hh:mm:ss ")+`</div>
										  </a>`);
				}else{

                    for(ind in result){	//展示二级列表信息
                        var record = result[ind];
                        $('#towList').append(`	  <a class="weui-cell weui-cell_access" href="javascript:;">
											<div class="weui-cell__hd"></div>
											<div class="weui-cell__bd">
											  <p>`+IFNULL(record.name,defStr)+`-`+IFNULL(record.sex,defStr)+`-`+IFNULL(record.age, defStr)+`-`+IFNULL(record.phone, defStr)+`</p>
											</div>
											<div class="weui-cell__ft">`+new Date(record.createTime).Format("MM-dd hh:mm:ss ")+`</div>
										  </a>`);


                    }
                }
                //完成下拉刷新
                $('.maxDiv').pullToRefreshDone();
			}
		});
	}


	//展示首页
    function showHome(){
        //隐藏二级列表
        $('#towDiv').hide();
        //展示一级列表
        $('#oneDiv').show();


    }

	//登陆
    function loginIn(){


        // $.login("自定义的消息内容", function(username, password) {
        //     // 这里进行登录操作
        // }, function() {
        // });
        //如果参数过多，建议通过 object 方式传入
        $.prompt({
            title: '登陆',
            text: '请输入登陆密码',
            input: '',  // 默认密码
            empty: false, // 是否允许为空
            onOK: function (input) {
                //点击确认
				if(input == 'wzr'){
                    $.alert('登陆成功，欢迎回来 ' + input + '。');
                    loginStarus = 'true';
                    //setCookie(loginStarus, 'true', 1000 * 60 * 30);//30分钟
				}else{
                    alert('密码错误，请重新登陆!');
                    loginIn();
				}
            },
			onCancel: function () {
				//点击取消
				alert('您取消登陆，点击确定将跳转到首页。');
                $('#listHtml').click();
                location.href = $('#listHtml').attr('href');
                //console.info('取消')
			}
        });
    }





    /**
	 * 页面加载完成
     */
	$(function(){

        $('.maxDiv').pullToRefresh(function () {
            // 下拉刷新触发时执行的操作放这里。
            // 从 v1.1.2 版本才支持回调函数，之前的版本只能通过事件监听

			if(type){
                getList(type);
            }else{
                //完成下拉刷新
                $('.maxDiv').pullToRefreshDone();
			}


        });


	    //查看历史明细
		$('.oneList').click(function(){

		    type = $(this).attr('name');
			//隐藏一级列表
			$('#oneDiv').hide();
			//展示二级列表
			$('#towDiv').show();
			
			getList(type);

		})
		//返回主页
		$('#home').click(function(){
            showHome();
		})

		//判断是否登陆
		if(loginStarus != 'true'){
		    loginIn();
		}


	})
	
</script>
</html>