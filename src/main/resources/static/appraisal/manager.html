<!DOCTYPE html>
<html lang="en" class="pixel-ratio-3 retina ios ios-10 ios-10-3 ios-gt-9 ios-gt-8 ios-gt-7 ios-gt-6">
<head>
    <meta charset="UTF-8">
	<meta http-equiv="X-UA-Compatible" content="IE=edge">
	<meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no">

	<meta name="description" content="Write an awesome description for your new site here. You can edit this line in _config.yml. It will appear in your document head meta (for Google search results) and in your feed.xml site description.
	">
    <title>测评后台管理</title>
    <!-- head 中 -->
    <link rel="stylesheet" href="https://cdn.bootcss.com/weui/1.1.2/style/weui.min.css">
    <link rel="stylesheet" href="https://cdn.bootcss.com/jquery-weui/1.2.0/css/jquery-weui.min.css">

	<link rel="stylesheet" href="common.css">
</head>



 <body ontouchstart="" style="background-color: rgb(246, 244, 236);">

 <!-- body 顶部加上如下代码 -->
 <div class="weui-pull-to-refresh__layer">
	 <div class='weui-pull-to-refresh__arrow'></div>
	 <div class='weui-pull-to-refresh__preloader'></div>
	 <div class="down">下拉刷新</div>
	 <div class="up">释放刷新</div>
	 <div class="refresh">正在刷新</div>
 </div>
 <!--<h1 class="demos-title">下拉刷新</h1>-->
 <header class="demos-header">
	<h1 class="demos-title" id="home">心理协会后台</h1>
	<!--<h5 class="demos-title" id="home">测评后台</h5>-->
</header>
<div id="oneDiv">



	 <div class="weui-cells__title">临汾市心理卫生协会（历史填报信息）：</div>
	<div class="weui-cells" style="background-color: rgb(246, 244, 236);">

	  <a class="weui-cell weui-cell_access oneList"  name="geilixinli_90" href="javascript:;">
		<div class="weui-cell__hd"><img src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAC4AAAAuCAMAAABgZ9sFAAAAVFBMVEXx8fHMzMzr6+vn5+fv7+/t7e3d3d2+vr7W1tbHx8eysrKdnZ3p6enk5OTR0dG7u7u3t7ejo6PY2Njh4eHf39/T09PExMSvr6+goKCqqqqnp6e4uLgcLY/OAAAAnklEQVRIx+3RSRLDIAxE0QYhAbGZPNu5/z0zrXHiqiz5W72FqhqtVuuXAl3iOV7iPV/iSsAqZa9BS7YOmMXnNNX4TWGxRMn3R6SxRNgy0bzXOW8EBO8SAClsPdB3psqlvG+Lw7ONXg/pTld52BjgSSkA3PV2OOemjIDcZQWgVvONw60q7sIpR38EnHPSMDQ4MjDjLPozhAkGrVbr/z0ANjAF4AcbXmYAAAAASUVORK5CYII=" alt="" style="width:20px;margin-right:5px;display:block"></div>
		<div class="weui-cell__bd">
		  <p>十项症状自评量表SCL90</p>
		</div>
		<div class="weui-cell__ft">90题</div>
	  </a>
	  <a class="weui-cell weui-cell_access oneList" name="pressure_PSTR" href="javascript:;">
		<div class="weui-cell__hd"><img src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAC4AAAAuCAMAAABgZ9sFAAAAVFBMVEXx8fHMzMzr6+vn5+fv7+/t7e3d3d2+vr7W1tbHx8eysrKdnZ3p6enk5OTR0dG7u7u3t7ejo6PY2Njh4eHf39/T09PExMSvr6+goKCqqqqnp6e4uLgcLY/OAAAAnklEQVRIx+3RSRLDIAxE0QYhAbGZPNu5/z0zrXHiqiz5W72FqhqtVuuXAl3iOV7iPV/iSsAqZa9BS7YOmMXnNNX4TWGxRMn3R6SxRNgy0bzXOW8EBO8SAClsPdB3psqlvG+Lw7ONXg/pTld52BjgSSkA3PV2OOemjIDcZQWgVvONw60q7sIpR38EnHPSMDQ4MjDjLPozhAkGrVbr/z0ANjAF4AcbXmYAAAAASUVORK5CYII=" alt="" style="width:20px;margin-right:5px;display:block"></div>
		<div class="weui-cell__bd">
		  <p>PSTR心理压力测试</p>
		</div>
		<div class="weui-cell__ft">50题</div>
	  </a>
	</div>
</div>
 <div id="towDiv"  style="display:none;">
	 <div class="weui-cells__title">姓名-性别-年龄-手机号：</div>
	<div id="towList" class="weui-cells" style="background-color: rgb(246, 244, 236);">
		<!-- 二级列表 -->
	</div>
</div>


</body>

<!-- body 最后 -->
<script src="https://cdn.bootcss.com/jquery/1.11.0/jquery.min.js"></script>
<script src="https://cdn.bootcss.com/jquery-weui/1.2.0/js/jquery-weui.min.js"></script>
<script src="../common/utils/commonUtils.js" type="text/javascript"></script>
<!-- 如果使用了某些拓展插件还需要额外的JS -->
<script src="https://cdn.bootcss.com/jquery-weui/1.2.0/js/swiper.min.js"></script>
<script src="https://cdn.bootcss.com/jquery-weui/1.2.0/js/city-picker.min.js"></script>
<script src="../common/utils/commonUtils.js"></script>

<script>
	var type;
	function getList(type) {
	    //清空二级列表数据
        $('#towList').html('');
		$.ajax({
		//几个参数需要注意一下
			type: "POST",//方法类型
			dataType: "jsonp",//预期服务器返回的数据类型
			url: "http://140.143.237.60:8010/appraisal/getSubjectRecordList.json" ,//url
			data: {
				limit:1000,
				offset:0,
				type:type,
				ditch:'lfsxlwsxh'
			},
			success: function (result) {
				console.log(result);//打印服务端返回的数据(调试用)
				//$('.q_info').remove();
				//$('#testform').append('<div class="q_info" style="display: block;" >' + result.html.replace(/@xiaoyu/g,'<').replace(/@dayu/g,'>') + '</div>');

                var defStr = '空';
                if(!result || result.length == 0){	//暂无填报记录
                    $('#towList').append(`	  <a class="weui-cell weui-cell_access" href="javascript:;">
											<div class="weui-cell__hd"></div>
											<div class="weui-cell__bd">
											  <p>暂无填报记录</p>
											</div>
											<div class="weui-cell__ft">`+new Date().Format("MM-dd hh:mm:ss ")+`</div>
										  </a>`);
				}else{

                    for(ind in result){	//展示二级列表信息
                        var record = result[ind];
                        $('#towList').append(`	  <a class="weui-cell weui-cell_access" href="javascript:;">
											<div class="weui-cell__hd"></div>
											<div class="weui-cell__bd">
											  <p>`+IFNULL(record.name,defStr)+`-`+IFNULL(record.sex,defStr)+`-`+IFNULL(record.age, defStr)+`-`+IFNULL(record.phone, defStr)+`</p>
											</div>
											<div class="weui-cell__ft">`+new Date(record.createTime).Format("MM-dd hh:mm:ss ")+`</div>
										  </a>`);


                    }
                }
                //完成下拉刷新
                $(document.body).pullToRefreshDone();
			}
		});
	}


    // var overscroll = function(el) {
    //     el.addEventListener('touchstart', function() {
    //         var top = el.scrollTop
    //             , totalScroll = el.scrollHeight
    //             , currentScroll = top + el.offsetHeight;
    //         //If we're at the top or the bottom of the containers
    //         //scroll, push up or down one pixel.
    //         //
    //         //this prevents the scroll from "passing through" to
    //         //the body.
    //         if(top === 0) {
    //             el.scrollTop = 1;
    //         } else if(currentScroll === totalScroll) {
    //             el.scrollTop = top - 1;
    //         }
    //     });
    // }
    // overscroll(document.querySelector('.scroll'));










	$(function(){
        // document.querySelector('body').addEventListener('touchmove', function(e) {
        //     e.preventDefault();
        // })
		//屏蔽下拉展示网页由XX提供
        // document.querySelector('body').addEventListener('touchstart', function (ev) {
         //    ev.preventDefault();
        // });



        // document.querySelector('body').addEventListener('touchstart', function(e) {
        //     console.info(e.target)
        //     console.info(document.querySelector('.demos-header').contains(e.target))
        //     if (!document.querySelector('.demos-header').contains(e.target)) {
        //         e.preventDefault();
        //     }
        // })












        $(document.body).pullToRefresh(function () {
            // 下拉刷新触发时执行的操作放这里。
            // 从 v1.1.2 版本才支持回调函数，之前的版本只能通过事件监听

			if(type){
                getList(type);
            }else{
                //完成下拉刷新
                $(document.body).pullToRefreshDone();
			}


        });


	    //查看历史明细
		$('.oneList').click(function(){
		    type = $(this).attr('name');
			//隐藏一级列表
			$('#oneDiv').hide();
			//展示二级列表
			$('#towDiv').show();
			
			getList(type);

		})
		//返回主页
		$('#home').click(function(){
            //隐藏二级列表
            $('#towDiv').hide();
            //展示一级列表
            $('#oneDiv').show();


		})

	})
	
</script>
</html>